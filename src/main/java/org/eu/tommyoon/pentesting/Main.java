package org.eu.tommyoon.pentesting;

import java.math.BigInteger;
import java.net.InetAddress;
import java.net.UnknownHostException;
import java.nio.ByteBuffer;

public class Main {
    public static void main(String[] args) throws UnknownHostException {
        String ipAddress = args[0];
        int cidr = Integer.parseInt(args[1]);

        findAvailableHosts(ipAddress, cidr);
    }

	private static void findAvailableHosts(String ipAddress, int cidr) throws UnknownHostException {
		byte[] bytes = InetAddress.getByName(ipAddress).getAddress();
        BigInteger ipVal = new BigInteger(1, bytes);

        BigInteger mask = BigInteger.ONE.shiftLeft(32 - cidr).subtract(BigInteger.ONE).not();
        BigInteger network = ipVal.and(mask);
        BigInteger broadcast = network.add(mask.not());

        for (BigInteger ip = network.add(BigInteger.ONE); ip.compareTo(broadcast) < 0; ip = ip.add(BigInteger.ONE)) {
            byte[] ipBytes = ByteBuffer.allocate(4).putInt(ip.intValue()).array();
            System.out.println(InetAddress.getByAddress(ipBytes).getHostAddress());
        }
	}
}
