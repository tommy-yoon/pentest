package org.eu.tommyoon.pentesting;

import org.eu.tommyoon.pentesting.shell.Spinner;
import org.jline.terminal.Terminal;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.shell.component.StringInput;
import org.springframework.shell.component.StringInput.StringInputContext;
import org.springframework.shell.standard.AbstractShellComponent;
import org.springframework.shell.standard.ShellComponent;
import org.springframework.shell.standard.ShellMethod;
import org.springframework.shell.standard.ShellOption;

//@ShellComponent
public class TestCommands extends AbstractShellComponent {
	
	@Autowired
	Terminal terminal;
	
	@Autowired
	Spinner spinner;
	
	@ShellMethod(value="hi", group="TEST")
	public String hello(@ShellOption String arg) {
		return "hello " + arg + "!!!!";
	}

	@ShellMethod(key = "string", value = "String input", group = "TEST")
	public String stringInput(boolean mask) {
		StringInput component = new StringInput(getTerminal(), "Enter value", "myvalue");
		component.setResourceLoader(getResourceLoader());
		component.setTemplateExecutor(getTemplateExecutor());
		if (mask) {
			component.setMaskCharacter('*');
		}
		StringInputContext context = component.run(StringInputContext.empty());
		return "Got value " + context.getResultValue();
	}
	
	@ShellMethod(key= {"term"}, value="Terminal test", group="TEST")
	public void testTerminal() {
		terminal.writer().println("hi");
		terminal.writer().flush();
	}
	
	@ShellMethod(key= {"test", "t"}, value="TEST", group="TEST")
	public void test() {
		System.out.println("test");
		spinner.start();
		try {
            Thread.sleep(3000); // Simulate a 3-second task
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
		spinner.stop();
	}
}